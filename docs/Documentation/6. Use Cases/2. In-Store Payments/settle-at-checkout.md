# Settle at Checkout

This use case is based on the premise that you already have an Electronic Cash Registry (ECR) or a Payment Terminal (POS) at your physical store checkout, and that the software on that device is enhanced to support Settle.

The basic flow is:

1. With items brought to the checkout the customer is ready to pay.
2. Merchants can choose if they want to accept Settle at the checkout in-store using either:
    1. Customer Initiated, orMerchants can choose if they want to accept Settle at the checkout in-store using either:
    2. Merchant Initiated payments.

        > #### Note
        >
        > Customer Initiated means the Customer scans the Settle QR Code to start the payment flow. Merchant Initiated means the Merchant has the phone number of the Customer (recently obtained or on file) and sends a payment request to the phone number to start the payment flow. When doing an integration it is recommended to support both methods, so that the Merchant may test and choose what model works best, and possibly provide both as the need and use case evolves.

3. For Customer Initiated payments a QR Code is needed. During checkout the Settle QR Code is presented either:

    1. Digitally on a screen, or
    2. As a sticker or printout.

        > #### Note
        >
        > Settle QR Codes may be Static or Dynamic. Static QR Codes are cheap and functional but they have no session handling. Much like a card terminal that can only deal with one payment from one card at any given time, whoever scans the static QR Code will pick up the next payment request. Dynamic QR Codes require a digital representation, are generated on the fly and require programmatic management. The benefit of dynamic QR Codes is the ability to separate Customer sessions with confidence. Settle offers premade (static) QR Code stickers as an alternative to (static) print-outs, and (dynamic) digital QR Codes. Premade QR Codes come with a serial number that the ECR / POS will use to claim the QR Code for its use. Digital QR Codes are provided by the Settle Server (or may be generated by the ECR / POS) as the [ECR / POS is configured and requests Shortlinks](/merchant-api/b3A6MTUzOTU0Mjk-merchant-shortlink-create).

4. The Customer scans the QR Code with the Settle App and the Customer Initiated transaction flow starts:

    1. The Settle App delivers the contents of the button / QR code (Shortlink) to the Settle Server.
    2. The Settle Server identifies what Merchant owns the Shortlink and makes the event (that a ‘scan’ has happened) available to the Merchant through the Settle API.

        > #### Advanced Options
        >
        > When configuring your integration you can choose to register a Callback URI that the Settle Servers will use to notify your application of events and outcomes. As an alternative you can poll the appropriate API endpoint for updated information. We do not recommend polling, especially for Customer Initiated transactions, as doing so will produce wasteful network traffic and yield a slow user experience compared to event based implementations.

    3. The ECR / POS application has been notified of the event (that a ‘scan’ has happened) and has received a scan token ID from the Settle Server.

        > #### Note
        >
        > A scan token ID is a temporary (lasts for 24 hours), anonymized customer ID that can be used by the Merchant to issue Requests to the Customer.

          > #### Advanced Options
          >
          > Since the ECR / POS has been notified that the Customer has scanned the QR and is ready to pay with Settle, the ECR / POS can inform the Merchant staff about this and automatically send the Payment Request to the Customer when all items has been recorded and the order amount is known. This will speed up the user experience when paying with Settle, and avoid the need for Merchant staff and Customer to verbally communicate about the payment alternatives, as the Customer has already selected to pay with Settle.

        > #### Advanced Options
        >
        > Since the ECR / POS has been notified that the Customer has scanned the QR, the ECR / POS can issue a Permission Request to obtain access to Customer data. Such Customer data may be an email address, phone number or other identifier that may be used by the Merchant for loyalty programs. Check out Value Added Services for further details.

    4. The ECR / POS knows the order, the amount due, and now has a match between that order and the customer (from the scan token ID). With this information the ECR / POS can issue a Payment Request.
    5. The ECR / POS issues a payment request, for the order amount, with the recipient set to the scan token ID and sends it to the Settle Server.
    6. The Settle Server forwards the payment request to the Customer on their phone inside the secure environment of the Settle App.
    7. The Customer approves the payment in the Settle App with a swipe.
    8. The Settle Server processes the payment and delivers the outcome of the transaction to the Customer in the Settle App, as well as to the ECR / POS via the API.The Customer scans the QR Code with the Settle App and the Customer Initiated transaction flow starts:
    9. With a successful payment outcome the ECR / POS can confirm that the order has been paid and issue a receipt to the Customer.

5. If the Merchant has the customer’s phone number (recently obtained or kept on file) the Merchant Initiated transaction flow can start:
    1. The ECR / POS knows the order, the amount due, and now has a match between that order and the customer (with the mobile number). With this information the Merchant can issue a Payment Request.
    2. The ECR / POS issues a payment request, for the order amount, with the recipient set to the mobile phone number and sends it to the Settle Servers.
    3. The Settle Server forwards the payment request to the Customer on their phone inside the secure environment of the Settle App.
    4. The Customer approves the payment in the Settle App with a swipe.
    5. The Settle Server processes the payment and delivers the outcome of the transaction to the Customer in the Settle App, as well as to the ECR / POS via the API.
    6. With a successful payment outcome the ECR / POS can confirm that the order has been paid and issue a receipt to the Customer.